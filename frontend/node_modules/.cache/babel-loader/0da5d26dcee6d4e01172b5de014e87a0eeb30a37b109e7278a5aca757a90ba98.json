{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Home\\\\Documents\\\\UpGrad-Project\\\\upgrad-eshop\\\\frontend\\\\src\\\\hooks\\\\useAuthentication.js\",\n  _s = $RefreshSig$();\nimport { createContext, useState } from \"react\";\nimport { doLogin } from \"../api/userAuthAPIs\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthCtx = /*#__PURE__*/createContext();\n\n//Note: this hook is used for auth purposes and will be saved in browser cache\nconst useAuthentication = () => {\n  _s();\n  let initialState = localStorage.getItem(\"ecommerce_upgrad_logged_in_user_details\");\n  let persistInCache = json => {\n    console.log(json);\n    initialState.user = json.username;\n    initialState.userId = json.userId;\n    initialState.roles = json.roles;\n    initialState.accessToken = json.accessToken;\n    initialState.accessTokenTimeout = json.accessTokenTimeout;\n    localStorage.setItem(\"ecommerce_upgrad_logged_in_user_details\", JSON.stringify(initialState));\n  };\n  console.log(initialState);\n  let clearCache = () => {\n    initialState = {\n      user: null,\n      userId: null,\n      roles: null,\n      accessToken: null,\n      accessTokenTimeout: null\n    };\n    localStorage.setItem(\"ecommerce_upgrad_logged_in_user_details\", JSON.stringify(initialState));\n  };\n  if (initialState === null || initialState === undefined) {\n    initialState = {\n      user: null,\n      userId: null,\n      roles: null,\n      accessToken: null,\n      accessTokenTimeout: null\n    };\n  } else {\n    initialState = JSON.parse(initialState);\n    if (initialState.accessTokenTimeout !== null && initialState.accessTokenTimeout < Date.now()) {\n      clearCache();\n    }\n  }\n  const [loggedInUser, setLoggedInUser] = useState(initialState.user);\n  const [loggedInUserId, setLoggedInUserId] = useState(initialState.userId);\n  const [roles, setRoles] = useState(initialState.roles);\n  const [accessToken, setAccessToken] = useState(initialState.accessToken);\n  const [accessTokenTimeout, setAccessTokenTimeout] = useState(initialState.accessTokenTimeout);\n  const [loginError, setLoginError] = useState(null);\n  console.log(loggedInUser);\n  const login = (email, password) => {\n    let promiseResolveRef = null;\n    let promiseRejectRef = null;\n    let promise = new Promise((resolve, reject) => {\n      promiseResolveRef = resolve;\n      promiseRejectRef = reject;\n    });\n    doLogin(email, password).then(json => {\n      setLoggedInUser(json.username);\n      setLoggedInUserId(json.userId);\n      setRoles(json.roles);\n      setAccessToken(json.accessToken);\n      setAccessTokenTimeout(json.accessTokenTimeout);\n      setLoginError(null);\n      persistInCache(json);\n      promiseResolveRef(json);\n    }).catch(json => {\n      setLoggedInUser(null);\n      setLoggedInUserId(null);\n      setRoles(null);\n      setAccessToken(null);\n      setAccessTokenTimeout(null);\n      setLoginError(json.reason);\n      promiseRejectRef(json);\n    });\n    return promise;\n  };\n  const logout = () => {\n    setLoggedInUser(null);\n    setLoggedInUserId(null);\n    setRoles(null);\n    setAccessToken(null);\n    setAccessTokenTimeout(null);\n    setLoginError(null);\n    clearCache();\n    return new Promise(resolve => {\n      resolve();\n    });\n  };\n  const hasRole = roleArray => {\n    if (roleArray === undefined || roleArray === null) {\n      return true;\n    }\n    if (initialState.roles !== null) {\n      // for (let i = 0; i < initialState.roles.length; i++) {\n      // \tfor (let j = 0; j < roleArray.length; j++) {\n      // \t\tif (initialState.roles[i] === roleArray[j]) {\n      // \t\t\treturn true;\n      // \t\t}\n      // \t}\n      // }\n      return true;\n    }\n    return false;\n  };\n  const isAccessTokenValid = () => {\n    return !(accessTokenTimeout !== null && accessTokenTimeout < Date.now());\n  };\n  return {\n    AuthCtx,\n    AuthProvider: ({\n      children\n    }) => /*#__PURE__*/_jsxDEV(AuthCtx.Provider, {\n      value: {\n        loginError,\n        loggedInUser,\n        loggedInUserId,\n        accessToken,\n        accessTokenTimeout,\n        roles,\n        login,\n        logout,\n        hasRole,\n        isAccessTokenValid\n      },\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 4\n    }, this)\n  };\n};\n_s(useAuthentication, \"E+68Z60H/tGqDSEFgDMN3zNNuQk=\");\nexport default useAuthentication;","map":{"version":3,"names":["createContext","useState","doLogin","jsxDEV","_jsxDEV","AuthCtx","useAuthentication","_s","initialState","localStorage","getItem","persistInCache","json","console","log","user","username","userId","roles","accessToken","accessTokenTimeout","setItem","JSON","stringify","clearCache","undefined","parse","Date","now","loggedInUser","setLoggedInUser","loggedInUserId","setLoggedInUserId","setRoles","setAccessToken","setAccessTokenTimeout","loginError","setLoginError","login","email","password","promiseResolveRef","promiseRejectRef","promise","Promise","resolve","reject","then","catch","reason","logout","hasRole","roleArray","isAccessTokenValid","AuthProvider","children","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber"],"sources":["C:/Users/Home/Documents/UpGrad-Project/upgrad-eshop/frontend/src/hooks/useAuthentication.js"],"sourcesContent":["import {createContext, useState} from \"react\";\nimport {doLogin} from \"../api/userAuthAPIs\";\n\nconst AuthCtx = createContext();\n\n//Note: this hook is used for auth purposes and will be saved in browser cache\nconst useAuthentication = () => {\n\n\tlet initialState = localStorage.getItem(\"ecommerce_upgrad_logged_in_user_details\");\n\n\tlet persistInCache = (json) => {\n\t\tconsole.log(json);\n\t\tinitialState.user = json.username;\n\t\tinitialState.userId = json.userId;\n\t\tinitialState.roles = json.roles;\n\t\tinitialState.accessToken = json.accessToken;\n\t\tinitialState.accessTokenTimeout = json.accessTokenTimeout;\n\t\tlocalStorage.setItem(\"ecommerce_upgrad_logged_in_user_details\", JSON.stringify(initialState));\n\t};\n\n\tconsole.log(initialState);\n\n\tlet clearCache = () => {\n\t\tinitialState = {\n\t\t\tuser: null,\n\t\t\tuserId: null,\n\t\t\troles: null,\n\t\t\taccessToken: null,\n\t\t\taccessTokenTimeout: null,\n\t\t};\n\t\tlocalStorage.setItem(\"ecommerce_upgrad_logged_in_user_details\", JSON.stringify(initialState));\n\t};\n\n\tif(initialState === null || initialState === undefined) {\n\t\tinitialState = {\n\t\t\tuser: null,\n\t\t\tuserId: null,\n\t\t\troles: null,\n\t\t\taccessToken: null,\n\t\t\taccessTokenTimeout: null,\n\t\t};\n\t} else {\n\t\tinitialState = JSON.parse(initialState);\n\t\tif(initialState.accessTokenTimeout !== null && initialState.accessTokenTimeout < Date.now()) {\n\t\t\tclearCache();\n\t\t}\n\t}\n\n\n\tconst [loggedInUser, setLoggedInUser] = useState(initialState.user);\n\tconst [loggedInUserId, setLoggedInUserId] = useState(initialState.userId);\n\tconst [roles, setRoles] = useState(initialState.roles);\n\tconst [accessToken, setAccessToken] = useState(initialState.accessToken);\n\tconst [accessTokenTimeout, setAccessTokenTimeout] = useState(initialState.accessTokenTimeout);\n\tconst [loginError, setLoginError] = useState(null);\n\n\tconsole.log(loggedInUser);\n\n\tconst login = (email, password) => {\n\t\tlet promiseResolveRef = null;\n\t\tlet promiseRejectRef = null;\n\t\tlet promise = new Promise((resolve, reject) => {\n\t\t\tpromiseResolveRef = resolve;\n\t\t\tpromiseRejectRef = reject;\n\t\t});\n\t\tdoLogin(email, password).then(json => {\n\t\t\tsetLoggedInUser(json.username);\n\t\t\tsetLoggedInUserId(json.userId);\n\t\t\tsetRoles(json.roles);\n\t\t\tsetAccessToken(json.accessToken);\n\t\t\tsetAccessTokenTimeout(json.accessTokenTimeout);\n\t\t\tsetLoginError(null);\n\t\t\tpersistInCache(json);\n\t\t\tpromiseResolveRef(json);\n\t\t}).catch(json => {\n\t\t\tsetLoggedInUser(null);\n\t\t\tsetLoggedInUserId(null);\n\t\t\tsetRoles(null);\n\t\t\tsetAccessToken(null);\n\t\t\tsetAccessTokenTimeout(null);\n\t\t\tsetLoginError(json.reason);\n\t\t\tpromiseRejectRef(json);\n\t\t});\n\t\treturn promise;\n\t};\n\n\tconst logout = () => {\n\t\tsetLoggedInUser(null);\n\t\tsetLoggedInUserId(null);\n\t\tsetRoles(null);\n\t\tsetAccessToken(null);\n\t\tsetAccessTokenTimeout(null);\n\t\tsetLoginError(null);\n\t\tclearCache();\n\t\treturn new Promise((resolve) => {\n\t\t\tresolve();\n\t\t});\n\t};\n\n\tconst hasRole = (roleArray) => {\n\t\tif(roleArray === undefined || roleArray === null) {\n\t\t\treturn true;\n\t\t}\n\t\tif(initialState.roles !== null) {\n\t\t\t// for (let i = 0; i < initialState.roles.length; i++) {\n\t\t\t// \tfor (let j = 0; j < roleArray.length; j++) {\n\t\t\t// \t\tif (initialState.roles[i] === roleArray[j]) {\n\t\t\t// \t\t\treturn true;\n\t\t\t// \t\t}\n\t\t\t// \t}\n\t\t\t// }\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\n\tconst isAccessTokenValid = () => {\n\t\treturn !(accessTokenTimeout !== null && accessTokenTimeout < Date.now());\n\t};\n\n\treturn {\n\t\tAuthCtx,\n\t\tAuthProvider: ({ children }) => (\n\t\t\t<AuthCtx.Provider value={{ loginError, loggedInUser, loggedInUserId, accessToken, accessTokenTimeout, roles, login, logout, hasRole, isAccessTokenValid }}>\n\t\t\t\t{children}\n\t\t\t</AuthCtx.Provider>\n\t\t)\n\t};\n};\n\nexport default useAuthentication;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}