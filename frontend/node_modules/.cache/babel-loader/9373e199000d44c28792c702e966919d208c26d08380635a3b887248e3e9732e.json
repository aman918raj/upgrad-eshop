{"ast":null,"code":"import _slicedToArray from\"C:/Users/Home/Documents/UpGrad-Project/upgrad-eshop/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{createContext,useState}from\"react\";import{doLogin}from\"../api/userAuthAPIs\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthCtx=/*#__PURE__*/createContext();//Note: this hook is used for auth purposes and will be saved in browser cache\nvar useAuthentication=function useAuthentication(){var initialState=localStorage.getItem(\"ecommerce_upgrad_logged_in_user_details\");var persistInCache=function persistInCache(json){console.log(json);initialState.user=json.username;initialState.userId=json.userId;initialState.roles=json.roles;initialState.accessToken=json.accessToken;initialState.accessTokenTimeout=json.accessTokenTimeout;localStorage.setItem(\"ecommerce_upgrad_logged_in_user_details\",JSON.stringify(initialState));};console.log(initialState);var clearCache=function clearCache(){initialState={user:null,userId:null,roles:null,accessToken:null,accessTokenTimeout:null};localStorage.setItem(\"ecommerce_upgrad_logged_in_user_details\",JSON.stringify(initialState));};if(initialState===null||initialState===undefined){initialState={user:null,userId:null,roles:null,accessToken:null,accessTokenTimeout:null};}else{initialState=JSON.parse(initialState);if(initialState.accessTokenTimeout!==null&&initialState.accessTokenTimeout<Date.now()){clearCache();}}var _useState=useState(initialState.user),_useState2=_slicedToArray(_useState,2),loggedInUser=_useState2[0],setLoggedInUser=_useState2[1];var _useState3=useState(initialState.userId),_useState4=_slicedToArray(_useState3,2),loggedInUserId=_useState4[0],setLoggedInUserId=_useState4[1];var _useState5=useState(initialState.roles),_useState6=_slicedToArray(_useState5,2),roles=_useState6[0],setRoles=_useState6[1];var _useState7=useState(initialState.accessToken),_useState8=_slicedToArray(_useState7,2),accessToken=_useState8[0],setAccessToken=_useState8[1];var _useState9=useState(initialState.accessTokenTimeout),_useState10=_slicedToArray(_useState9,2),accessTokenTimeout=_useState10[0],setAccessTokenTimeout=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),loginError=_useState12[0],setLoginError=_useState12[1];console.log(loggedInUser);var login=function login(email,password){var promiseResolveRef=null;var promiseRejectRef=null;var promise=new Promise(function(resolve,reject){promiseResolveRef=resolve;promiseRejectRef=reject;});doLogin(email,password).then(function(json){setLoggedInUser(json.username);setLoggedInUserId(json.userId);setRoles(json.roles);setAccessToken(json.accessToken);setAccessTokenTimeout(json.accessTokenTimeout);setLoginError(null);persistInCache(json);promiseResolveRef(json);}).catch(function(json){setLoggedInUser(null);setLoggedInUserId(null);setRoles(null);setAccessToken(null);setAccessTokenTimeout(null);setLoginError(json.reason);promiseRejectRef(json);});return promise;};var logout=function logout(){setLoggedInUser(null);setLoggedInUserId(null);setRoles(null);setAccessToken(null);setAccessTokenTimeout(null);setLoginError(null);clearCache();return new Promise(function(resolve){resolve();});};var hasRole=function hasRole(roleArray){if(roleArray===undefined||roleArray===null){return true;}if(initialState.roles!==null){// for (let i = 0; i < initialState.roles.length; i++) {\n// \tfor (let j = 0; j < roleArray.length; j++) {\n// \t\tif (initialState.roles[i] === roleArray[j]) {\n// \t\t\treturn true;\n// \t\t}\n// \t}\n// }\nreturn true;}return false;};var isAccessTokenValid=function isAccessTokenValid(){return!(accessTokenTimeout!==null&&accessTokenTimeout<Date.now());};return{AuthCtx:AuthCtx,AuthProvider:function AuthProvider(_ref){var children=_ref.children;return/*#__PURE__*/_jsx(AuthCtx.Provider,{value:{loginError:loginError,loggedInUser:loggedInUser,loggedInUserId:loggedInUserId,accessToken:accessToken,accessTokenTimeout:accessTokenTimeout,roles:roles,login:login,logout:logout,hasRole:hasRole,isAccessTokenValid:isAccessTokenValid},children:children});}};};export default useAuthentication;","map":{"version":3,"names":["createContext","useState","doLogin","jsx","_jsx","AuthCtx","useAuthentication","initialState","localStorage","getItem","persistInCache","json","console","log","user","username","userId","roles","accessToken","accessTokenTimeout","setItem","JSON","stringify","clearCache","undefined","parse","Date","now","_useState","_useState2","_slicedToArray","loggedInUser","setLoggedInUser","_useState3","_useState4","loggedInUserId","setLoggedInUserId","_useState5","_useState6","setRoles","_useState7","_useState8","setAccessToken","_useState9","_useState10","setAccessTokenTimeout","_useState11","_useState12","loginError","setLoginError","login","email","password","promiseResolveRef","promiseRejectRef","promise","Promise","resolve","reject","then","catch","reason","logout","hasRole","roleArray","isAccessTokenValid","AuthProvider","_ref","children","Provider","value"],"sources":["C:/Users/Home/Documents/UpGrad-Project/upgrad-eshop/frontend/src/hooks/useAuthentication.js"],"sourcesContent":["import {createContext, useState} from \"react\";\nimport {doLogin} from \"../api/userAuthAPIs\";\n\nconst AuthCtx = createContext();\n\n//Note: this hook is used for auth purposes and will be saved in browser cache\nconst useAuthentication = () => {\n\n\tlet initialState = localStorage.getItem(\"ecommerce_upgrad_logged_in_user_details\");\n\n\tlet persistInCache = (json) => {\n\t\tconsole.log(json);\n\t\tinitialState.user = json.username;\n\t\tinitialState.userId = json.userId;\n\t\tinitialState.roles = json.roles;\n\t\tinitialState.accessToken = json.accessToken;\n\t\tinitialState.accessTokenTimeout = json.accessTokenTimeout;\n\t\tlocalStorage.setItem(\"ecommerce_upgrad_logged_in_user_details\", JSON.stringify(initialState));\n\t};\n\n\tconsole.log(initialState);\n\n\tlet clearCache = () => {\n\t\tinitialState = {\n\t\t\tuser: null,\n\t\t\tuserId: null,\n\t\t\troles: null,\n\t\t\taccessToken: null,\n\t\t\taccessTokenTimeout: null,\n\t\t};\n\t\tlocalStorage.setItem(\"ecommerce_upgrad_logged_in_user_details\", JSON.stringify(initialState));\n\t};\n\n\tif(initialState === null || initialState === undefined) {\n\t\tinitialState = {\n\t\t\tuser: null,\n\t\t\tuserId: null,\n\t\t\troles: null,\n\t\t\taccessToken: null,\n\t\t\taccessTokenTimeout: null,\n\t\t};\n\t} else {\n\t\tinitialState = JSON.parse(initialState);\n\t\tif(initialState.accessTokenTimeout !== null && initialState.accessTokenTimeout < Date.now()) {\n\t\t\tclearCache();\n\t\t}\n\t}\n\n\n\tconst [loggedInUser, setLoggedInUser] = useState(initialState.user);\n\tconst [loggedInUserId, setLoggedInUserId] = useState(initialState.userId);\n\tconst [roles, setRoles] = useState(initialState.roles);\n\tconst [accessToken, setAccessToken] = useState(initialState.accessToken);\n\tconst [accessTokenTimeout, setAccessTokenTimeout] = useState(initialState.accessTokenTimeout);\n\tconst [loginError, setLoginError] = useState(null);\n\n\tconsole.log(loggedInUser);\n\n\tconst login = (email, password) => {\n\t\tlet promiseResolveRef = null;\n\t\tlet promiseRejectRef = null;\n\t\tlet promise = new Promise((resolve, reject) => {\n\t\t\tpromiseResolveRef = resolve;\n\t\t\tpromiseRejectRef = reject;\n\t\t});\n\t\tdoLogin(email, password).then(json => {\n\t\t\tsetLoggedInUser(json.username);\n\t\t\tsetLoggedInUserId(json.userId);\n\t\t\tsetRoles(json.roles);\n\t\t\tsetAccessToken(json.accessToken);\n\t\t\tsetAccessTokenTimeout(json.accessTokenTimeout);\n\t\t\tsetLoginError(null);\n\t\t\tpersistInCache(json);\n\t\t\tpromiseResolveRef(json);\n\t\t}).catch(json => {\n\t\t\tsetLoggedInUser(null);\n\t\t\tsetLoggedInUserId(null);\n\t\t\tsetRoles(null);\n\t\t\tsetAccessToken(null);\n\t\t\tsetAccessTokenTimeout(null);\n\t\t\tsetLoginError(json.reason);\n\t\t\tpromiseRejectRef(json);\n\t\t});\n\t\treturn promise;\n\t};\n\n\tconst logout = () => {\n\t\tsetLoggedInUser(null);\n\t\tsetLoggedInUserId(null);\n\t\tsetRoles(null);\n\t\tsetAccessToken(null);\n\t\tsetAccessTokenTimeout(null);\n\t\tsetLoginError(null);\n\t\tclearCache();\n\t\treturn new Promise((resolve) => {\n\t\t\tresolve();\n\t\t});\n\t};\n\n\tconst hasRole = (roleArray) => {\n\t\tif(roleArray === undefined || roleArray === null) {\n\t\t\treturn true;\n\t\t}\n\t\tif(initialState.roles !== null) {\n\t\t\t// for (let i = 0; i < initialState.roles.length; i++) {\n\t\t\t// \tfor (let j = 0; j < roleArray.length; j++) {\n\t\t\t// \t\tif (initialState.roles[i] === roleArray[j]) {\n\t\t\t// \t\t\treturn true;\n\t\t\t// \t\t}\n\t\t\t// \t}\n\t\t\t// }\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t};\n\n\tconst isAccessTokenValid = () => {\n\t\treturn !(accessTokenTimeout !== null && accessTokenTimeout < Date.now());\n\t};\n\n\treturn {\n\t\tAuthCtx,\n\t\tAuthProvider: ({ children }) => (\n\t\t\t<AuthCtx.Provider value={{ loginError, loggedInUser, loggedInUserId, accessToken, accessTokenTimeout, roles, login, logout, hasRole, isAccessTokenValid }}>\n\t\t\t\t{children}\n\t\t\t</AuthCtx.Provider>\n\t\t)\n\t};\n};\n\nexport default useAuthentication;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}